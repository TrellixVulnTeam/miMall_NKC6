{"remainingRequest":"/home/manhuax/xmh/2021/Vue全家桶高访小米商城/my code/MiMall-xmh/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/manhuax/xmh/2021/Vue全家桶高访小米商城/my code/MiMall-xmh/src/pages/orderPay.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/manhuax/xmh/2021/Vue全家桶高访小米商城/my code/MiMall-xmh/src/pages/orderPay.vue","mtime":1631953596916},{"path":"/home/manhuax/xmh/2021/Vue全家桶高访小米商城/my code/MiMall-xmh/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/manhuax/xmh/2021/Vue全家桶高访小米商城/my code/MiMall-xmh/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/manhuax/xmh/2021/Vue全家桶高访小米商城/my code/MiMall-xmh/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/manhuax/xmh/2021/Vue全家桶高访小米商城/my code/MiMall-xmh/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBRUkNvZGUgZnJvbSAicXJjb2RlIjsKaW1wb3J0IE9yZGVySGVhZGVyIGZyb20gIi4vLi4vY29tcG9uZW50cy9PcmRlckhlYWRlciI7CmltcG9ydCBTY2FuUGF5Q29kZSBmcm9tICIuLy4uL2NvbXBvbmVudHMvU2NhblBheUNvZGUiOwppbXBvcnQgTW9kYWwgZnJvbSAiLi8uLi9jb21wb25lbnRzL01vZGFsIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJvcmRlci1wYXkiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBvcmRlcklkOiB0aGlzLiRyb3V0ZS5xdWVyeS5vcmRlck5vLAogICAgICBhZGRyZXNzSW5mbzogIiIsIC8v5pS26LSn5Lq65Zyw5Z2ACiAgICAgIG9yZGVyRGV0YWlsOiBbXSwgLy/orqLljZXor6bmg4XvvIzljIXlkKvllYblk4HliJfooagKICAgICAgc2hvd0RldGFpbDogZmFsc2UsIC8v5piv5ZCm5pi+56S66K6i5Y2V6K+m5oOFCiAgICAgIHBheVR5cGU6ICIiLCAvL+aUr+S7mOexu+WeiwogICAgICBzaG93UGF5OiBmYWxzZSwgLy/mmK/lkKbmmL7npLrlvq7kv6HmlK/ku5jlvLnmoYYKICAgICAgcGF5SW1nOiAiIiwgLy/lvq7kv6HmlK/ku5jnmoTkuoznu7TnoIHlnLDlnYAKICAgICAgc2hvd1BheU1vZGFsOiBmYWxzZSwgLy/mmK/lkKbmmL7npLrkuozmrKHmlK/ku5jnoa7orqTlvLnmoYYKICAgICAgcGF5bWVudDogMCwgLy/orqLljZXmgLvph5Hpop0KICAgICAgVDogIiIsIC8v5a6a5pe25ZmoSUQKICAgIH07CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBPcmRlckhlYWRlciwKICAgIFNjYW5QYXlDb2RlLAogICAgTW9kYWwsCiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5nZXRPcmRlckRldGFpbCgpOwogIH0sCiAgbWV0aG9kczogewogICAgZ2V0T3JkZXJEZXRhaWwoKSB7CiAgICAgIHRoaXMuYXhpb3MuZ2V0KGAvb3JkZXJzLyR7dGhpcy5vcmRlcklkfWApLnRoZW4oKHJlcykgPT4gewogICAgICAgIGxldCBpdGVtID0gcmVzLnNoaXBwaW5nVm87CiAgICAgICAgdGhpcy5hZGRyZXNzSW5mbyA9IGAke2l0ZW0ucmVjZWl2ZXJOYW1lfSAke2l0ZW0ucmVjZWl2ZXJNb2JpbGV9ICR7aXRlbS5yZWNlaXZlclByb3ZpbmNlfSAke2l0ZW0ucmVjZWl2ZXJDaXR5fSAke2l0ZW0ucmVjZWl2ZXJEaXN0cmljdH0gJHtpdGVtLnJlY2VpdmVyQWRkcmVzc31gOwogICAgICAgIHRoaXMub3JkZXJEZXRhaWwgPSByZXMub3JkZXJJdGVtVm9MaXN0OwogICAgICAgIHRoaXMucGF5bWVudCA9IHJlcy5wYXltZW50OwogICAgICB9KTsKICAgIH0sCiAgICBwYXlTdWJtaXQocGF5VHlwZSkgewogICAgICBpZiAocGF5VHlwZSA9PSAxKSB7CiAgICAgICAgd2luZG93Lm9wZW4oIi8jL29yZGVyL2FsaXBheT9vcmRlcklkPSIgKyB0aGlzLm9yZGVySWQsICJfYmxhbmsiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmF4aW9zCiAgICAgICAgICAucG9zdCgiL3BheSIsIHsKICAgICAgICAgICAgb3JkZXJJZDogdGhpcy5vcmRlcklkLAogICAgICAgICAgICBvcmRlck5hbWU6ICJWdWXpq5jku7/lsI/nsbPllYbln44iLAogICAgICAgICAgICBhbW91bnQ6IDAuMDEsIC8v5Y2V5L2N5YWDCiAgICAgICAgICAgIHBheVR5cGU6IDIsIC8vMeaUr+S7mOWune+8jDLlvq7kv6EKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIFFSQ29kZS50b0RhdGFVUkwocmVzLmNvbnRlbnQpIC8v5oqKcmVzLmNvbnRlbnTovazmjaLmiJDkuoznu7TnoIEKICAgICAgICAgICAgICAudGhlbigodXJsKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dQYXkgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wYXlJbWcgPSB1cmw7CiAgICAgICAgICAgICAgICB0aGlzLmxvb3BPcmRlclN0YXRlKCk7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5b6u5L+h5LqM57u056CB55Sf5oiQ5aSx6LSl77yM6K+356iN5ZCO6YeN6K+VIik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIC8vIOWFs+mXreW+ruS/oeW8ueahhgogICAgY2xvc2VQYXlNb2RhbCgpIHsKICAgICAgdGhpcy5zaG93UGF5ID0gZmFsc2U7CiAgICAgIHRoaXMuc2hvd1BheU1vZGFsID0gdHJ1ZTsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLlQpOwogICAgfSwKICAgIC8vIOi9ruivouW9k+WJjeiuouWNleaUr+S7mOeKtuaAgQogICAgbG9vcE9yZGVyU3RhdGUoKSB7CiAgICAgIHRoaXMuVCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICB0aGlzLmF4aW9zLmdldChgL29yZGVycy8ke3RoaXMub3JkZXJJZH1gKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5UKTsKICAgICAgICAgICAgdGhpcy5nb09yZGVyTGlzdCgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LCAxMDAwKTsKICAgIH0sCiAgICBnb09yZGVyTGlzdCgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goIi9vcmRlci9saXN0Iik7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["orderPay.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"orderPay.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n  <div class=\"order-pay\">\n    <order-header title=\"订单支付\">\n      <template v-slot:tip>\n        <span>请谨防钓鱼链接或诈骗电话，了解更多</span>\n      </template>\n    </order-header>\n    <div class=\"wrapper\">\n      <div class=\"container\">\n        <div class=\"order-wrap\">\n          <div class=\"item-order\">\n            <div class=\"icon-succ\"></div>\n            <div class=\"order-info\">\n              <h2>订单提交成功！去付款咯～</h2>\n              <p>请在<span>30分</span>内完成支付, 超时后将取消订单</p>\n              <p>收货信息：{{ addressInfo }}</p>\n            </div>\n            <div class=\"order-total\">\n              <p>\n                应付总额：<span>{{ payment }}</span\n                >元\n              </p>\n              <p>\n                订单详情<em\n                  class=\"icon-down\"\n                  :class=\"{ up: showDetail }\"\n                  @click=\"showDetail = !showDetail\"\n                ></em>\n              </p>\n            </div>\n          </div>\n          <div class=\"item-detail\" v-if=\"showDetail\">\n            <div class=\"item\">\n              <div class=\"detail-title\">订单号：</div>\n              <div class=\"detail-info theme-color\">{{ orderId }}</div>\n            </div>\n            <div class=\"item\">\n              <div class=\"detail-title\">收货信息：</div>\n              <div class=\"detail-info\">{{ addressInfo }}</div>\n            </div>\n            <div class=\"item good\">\n              <div class=\"detail-title\">商品名称：</div>\n              <div class=\"detail-info\">\n                <ul>\n                  <li v-for=\"(item, index) in orderDetail\" :key=\"index\">\n                    <img v-lazy=\"item.productImage\" />{{ item.productName }}\n                  </li>\n                </ul>\n              </div>\n            </div>\n            <div class=\"item\">\n              <div class=\"detail-title\">发票信息：</div>\n              <div class=\"detail-info\">电子发票 个人</div>\n            </div>\n          </div>\n        </div>\n        <div class=\"item-pay\">\n          <h3>选择以下支付方式付款</h3>\n          <div class=\"pay-way\">\n            <p>支付平台</p>\n            <div\n              class=\"pay pay-ali\"\n              :class=\"{ checked: payType == 1 }\"\n              @click=\"paySubmit(1)\"\n            ></div>\n            <div\n              class=\"pay pay-wechat\"\n              :class=\"{ checked: payType == 2 }\"\n              @click=\"paySubmit(2)\"\n            ></div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <scan-pay-code\n      v-if=\"showPay\"\n      @close=\"closePayModal\"\n      :img=\"payImg\"\n    ></scan-pay-code>\n    <modal\n      title=\"支付确认\"\n      btnType=\"3\"\n      :showModal=\"showPayModal\"\n      sureText=\"查看订单\"\n      cancelText=\"未支付\"\n      @cancel=\"showPayModal = false\"\n      @submit=\"goOrderList\"\n    >\n      <template v-slot:body>\n        <p>您确认是否完成支付？</p>\n      </template>\n    </modal>\n  </div>\n</template>\n<script>\nimport QRCode from \"qrcode\";\nimport OrderHeader from \"./../components/OrderHeader\";\nimport ScanPayCode from \"./../components/ScanPayCode\";\nimport Modal from \"./../components/Modal\";\nexport default {\n  name: \"order-pay\",\n  data() {\n    return {\n      orderId: this.$route.query.orderNo,\n      addressInfo: \"\", //收货人地址\n      orderDetail: [], //订单详情，包含商品列表\n      showDetail: false, //是否显示订单详情\n      payType: \"\", //支付类型\n      showPay: false, //是否显示微信支付弹框\n      payImg: \"\", //微信支付的二维码地址\n      showPayModal: false, //是否显示二次支付确认弹框\n      payment: 0, //订单总金额\n      T: \"\", //定时器ID\n    };\n  },\n  components: {\n    OrderHeader,\n    ScanPayCode,\n    Modal,\n  },\n  mounted() {\n    this.getOrderDetail();\n  },\n  methods: {\n    getOrderDetail() {\n      this.axios.get(`/orders/${this.orderId}`).then((res) => {\n        let item = res.shippingVo;\n        this.addressInfo = `${item.receiverName} ${item.receiverMobile} ${item.receiverProvince} ${item.receiverCity} ${item.receiverDistrict} ${item.receiverAddress}`;\n        this.orderDetail = res.orderItemVoList;\n        this.payment = res.payment;\n      });\n    },\n    paySubmit(payType) {\n      if (payType == 1) {\n        window.open(\"/#/order/alipay?orderId=\" + this.orderId, \"_blank\");\n      } else {\n        this.axios\n          .post(\"/pay\", {\n            orderId: this.orderId,\n            orderName: \"Vue高仿小米商城\",\n            amount: 0.01, //单位元\n            payType: 2, //1支付宝，2微信\n          })\n          .then((res) => {\n            QRCode.toDataURL(res.content) //把res.content转换成二维码\n              .then((url) => {\n                this.showPay = true;\n                this.payImg = url;\n                this.loopOrderState();\n              })\n              .catch(() => {\n                this.$message.error(\"微信二维码生成失败，请稍后重试\");\n              });\n          });\n      }\n    },\n    // 关闭微信弹框\n    closePayModal() {\n      this.showPay = false;\n      this.showPayModal = true;\n      clearInterval(this.T);\n    },\n    // 轮询当前订单支付状态\n    loopOrderState() {\n      this.T = setInterval(() => {\n        this.axios.get(`/orders/${this.orderId}`).then((res) => {\n          if (res.status == 20) {\n            clearInterval(this.T);\n            this.goOrderList();\n          }\n        });\n      }, 1000);\n    },\n    goOrderList() {\n      this.$router.push(\"/order/list\");\n    },\n  },\n};\n</script>\n<style lang=\"scss\">\n.order-pay {\n  .wrapper {\n    background-color: #f5f5f5;\n    padding-top: 30px;\n    padding-bottom: 61px;\n    .order-wrap {\n      padding: 62px 50px;\n      background-color: #fff;\n      font-size: 14px;\n      margin-bottom: 30px;\n      .item-order {\n        display: flex;\n        align-items: center;\n        .icon-succ {\n          width: 90px;\n          height: 90px;\n          border-radius: 50%;\n          background: url(\"/imgs/icon-gou.png\") #80c58a no-repeat center;\n          background-size: 60px;\n          margin-right: 40px;\n        }\n        .order-info {\n          margin-right: 248px;\n          h2 {\n            font-size: 24px;\n            color: #333333;\n            margin-bottom: 20px;\n          }\n          p {\n            color: #666666;\n            span {\n              color: #ff6700;\n            }\n          }\n        }\n        .order-total {\n          & > p:first-child {\n            margin-bottom: 30px;\n          }\n          span {\n            font-size: 28px;\n            color: #ff6700;\n          }\n          .icon-down {\n            display: inline-block;\n            width: 14px;\n            height: 10px;\n            background: url(\"/imgs/icon-down.png\") no-repeat center;\n            background-size: contain;\n            margin-left: 9px;\n            transition: all 0.5s;\n            cursor: pointer;\n            &.up {\n              transform: rotate(180deg);\n            }\n          }\n          .icon-up {\n            transform: rotate(180deg);\n          }\n        }\n      }\n      .item-detail {\n        border-top: 1px solid #d7d7d7;\n        padding-top: 47px;\n        padding-left: 130px;\n        font-size: 14px;\n        margin-top: 45px;\n        .item {\n          margin-bottom: 19px;\n          .detail-title {\n            float: left;\n            width: 100px;\n          }\n          .detail-info {\n            display: inline-block;\n            img {\n              width: 30px;\n              vertical-align: middle;\n            }\n          }\n        }\n      }\n    }\n    .item-pay {\n      padding: 26px 50px 72px;\n      background-color: #ffffff;\n      color: #333333;\n      h3 {\n        font-size: 20px;\n        font-weight: 200;\n        color: #333333;\n        padding-bottom: 24px;\n        border-bottom: 1px solid #d7d7d7;\n        margin-bottom: 26px;\n      }\n      .pay-way {\n        font-size: 18px;\n        .pay {\n          display: inline-block;\n          width: 188px;\n          height: 64px;\n          border: 1px solid #d7d7d7;\n          cursor: pointer;\n          &:last-child {\n            margin-left: 20px;\n          }\n          &.checked {\n            border: 1px solid #ff6700;\n          }\n        }\n        .pay-ali {\n          background: url(\"/imgs/pay/icon-ali.png\") no-repeat center;\n          background-size: 103px 38px;\n          margin-top: 19px;\n        }\n        .pay-wechat {\n          background: url(\"/imgs/pay/icon-wechat.png\") no-repeat center;\n          background-size: 103px 38px;\n        }\n      }\n    }\n  }\n}\n</style>"]}]}